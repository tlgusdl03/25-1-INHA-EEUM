
AIR_RULES = [
    (100, "ğŸŸ¢ ìµœìƒ", "í˜„ì¬ ê³µê¸°ê°€ ìµœìƒì…ë‹ˆë‹¤. ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ì„¸ìš”."),
    (80, "ğŸŸ¢ ì–‘í˜¸", "ê³µê¸° ì§ˆì´ ì¢‹ìŠµë‹ˆë‹¤. 3ì‹œê°„ í›„ ë‹¤ì‹œ ì ê²€í•˜ì„¸ìš”."),
    (60, "ğŸŸ¡ ë³´í†µ", "ê°€ë²¼ìš´ í™˜ê¸° ë˜ëŠ” ê³µê¸°ì²­ì •ê¸°ë¥¼ 30ë¶„ ê°€ë™í•˜ì„¸ìš”."),
    (40, "ğŸŸ  ë‚˜ì¨", "ì°½ë¬¸ì„ ì—´ì–´ ì¶©ë¶„íˆ í™˜ê¸°í•˜ê³ , ì†ŒìŒì„ ì¤„ì´ì„¸ìš”."),
    (0,  "ğŸ”´ ë§¤ìš° ë‚˜ì¨", "ì¦‰ì‹œ í™˜ê¸° + ë§ˆìŠ¤í¬ ì°©ìš©ì„ ê¶Œì¥í•©ë‹ˆë‹¤!"),
]

DI_RULES = [
    (100, "ğŸŸ¢ ì „ì› ì¾Œì ",  "ëª¨ë“  ì‚¬ìš©ìê°€ ì¾Œì í•˜ê²Œ ëŠë¼ëŠ” ìƒíƒœì…ë‹ˆë‹¤. "
         "í˜„ì¬ ì„¤ì •ì„ ìœ ì§€í•˜ê³ , 1â€“2 ì‹œê°„ í›„ ë‹¤ì‹œ ì ê²€í•˜ì„¸ìš”."),
    (80, "ğŸŸ¢ ì¾Œì ",  "ëŒ€ì²´ë¡œ ì¾Œì í•˜ì§€ë§Œ ì¥ì‹œê°„ ë¨¸ë¬´ë¥¼ ê²½ìš° ë¯¸ì„¸í•œ ì—´ê°ì´ ìƒê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. "
         "30 ë¶„ ê°„ê²©ìœ¼ë¡œ í™˜ê¸°í•˜ê±°ë‚˜, ëƒ‰ë°©Â·ì œìŠµ ì €ì „ë ¥ ëª¨ë“œë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤."),
    (60, "ğŸŸ¡ 10% ì •ë„ ë¶ˆì¾Œ",  "ì¼ë¶€ ì‚¬ìš©ìê°€ ë”ìœ„ë¥¼ ëŠë‚„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. "
         "ì €ì†ŒìŒ ëª¨ë“œë¡œ ì—ì–´ì»¨ ë˜ëŠ” ì œìŠµê¸°ë¥¼ ê°€ë™í•´ ì‹¤ë‚´ ì˜¨Â·ìŠµë„ë¥¼ ë¯¸ì„¸ ì¡°ì •í•˜ì„¸ìš”."),
    (40, "ğŸŸ  50% ì •ë„ ë¶ˆì¾Œ", "ë¶ˆì¾Œê°ì„ ëŠë¼ëŠ” ì‚¬ëŒì´ ì ˆë°˜ ìˆ˜ì¤€ì…ë‹ˆë‹¤. "
         "ì„ í’ê¸°ë‚˜ ì„œí˜ë ˆì´í„°ë¡œ ê³µê¸° ìˆœí™˜ì„ ëŠ˜ë¦¬ê³ , ëƒ‰ë°© ì˜¨ë„ë¥¼ 1â€“2 â„ƒ ë‚®ì¶° ì£¼ì„¸ìš”."),
    (20,  "ğŸŸ  ì „ì› ë¶ˆì¾Œ",  "ì‹¤ë‚´ ì²´ê°ì˜¨ë„ê°€ ë†’ìŠµë‹ˆë‹¤. ì—ì–´ì»¨ì„ ì¼œê³  ìµœì†Œ 15 ë¶„ ì´ìƒ ê¸‰ì† í™˜ê¸°í•˜ì„¸ìš”. "
         "ê°€ëŠ¥í•˜ë©´ ì–‡ì€ ì˜·ì°¨ë¦¼ì„ ê¶Œì¥í•©ë‹ˆë‹¤."),
    (0,  "ğŸ”´ ë§¤ìš° ë¶ˆì¾Œ",  "ì—ì–´ì»¨ì„ ê°•í•˜ê²Œ ê°€ë™í•˜ê³ , ì‹¤ë‚´ ìƒëŒ€ìŠµë„ë¥¼ 60% ì´í•˜ë¡œ ë‚®ì¶”ì„¸ìš”. "
         "ë…¸ì•½ìëŠ” ì‹¤ë‚´ í™œë™ì„ ìµœì†Œí™”í•˜ê³  ìˆ˜ë¶„ì„ ìì£¼ ì„­ì·¨í•˜ë„ë¡ ì•ˆë‚´í•˜ì„¸ìš”."),
]

NOISE_RULES = [
    (100, "ğŸŸ¢ ì¾Œì ",
         "ì¡°ìš©í•œ ê³µì› ìˆ˜ì¤€ì…ë‹ˆë‹¤. ìˆ˜ë©´ì— ê±°ì˜ ì˜í–¥ì´ ì—†ìŠµë‹ˆë‹¤. "
         "í˜„ì¬ ìƒíƒœë¥¼ ìœ ì§€í•˜ë©´ ì¢‹ìŠµë‹ˆë‹¤."),
    (80, "ğŸŸ¡ ì£¼ì˜ í•„ìš”",
         "ì¼ë°˜ ëŒ€í™”Â·ë°±í™”ì  ìˆ˜ì¤€ ì†ŒìŒì…ë‹ˆë‹¤. "
         "ìˆ˜ë©´ ì¥ì• ê°€ ì‹œì‘ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì•¼ê°„ì—ëŠ” ì°½ë¬¸ì„ ë‹«ê³ , ë°©ìŒ ì»¤íŠ¼ì„ ê¶Œì¥í•©ë‹ˆë‹¤."),
    (60,  "ğŸŸ  ë†’ì€ ì†ŒìŒ",
         "ì „í™” í†µí™”Â·TV ì‹œì²­ì— ë°©í•´ê°€ ë˜ëŠ” ìˆ˜ì¤€ì…ë‹ˆë‹¤. "
         "ì‘ì—…Â·í•™ìŠµ ëŠ¥ë¥ ì´ ë–¨ì–´ì§ˆ ìˆ˜ ìˆìœ¼ë‹ˆ ì†ŒìŒì›ì„ í™•ì¸í•˜ê³  ì°¨ë‹¨í•˜ê±°ë‚˜ ìœ„ì¹˜ë¥¼ ì¡°ì •í•˜ì„¸ìš”."),
    (40, "ğŸŸ  ìƒë‹¹í•œ ì†ŒìŒ",
         "ì² ë¡œ ë³€ ì†ŒìŒ ìˆ˜ì¤€ì…ë‹ˆë‹¤. ëŒ€í™”ê°€ ì–´ë µê³  ì²­ë ¥ ì¥ì• ê°€ ì‹œì‘ë  ìˆ˜ ìˆìœ¼ë¯€ë¡œ "
         "í•„ìš” ì‹œ ë°©ìŒ ëŒ€ì±…(ì°½ë¬¸Â·ë„ì–´ ì‹¤ë§)ê³¼ íœ´ì‹ ì‹œê°„ì„ ëŠ˜ë ¤ ì£¼ì„¸ìš”."),
    (20, "ğŸ”´ ë§¤ìš° ë†’ì€ ì†ŒìŒ",
         "ì†ŒìŒì´ ì‹¬í•œ ê³µì¥ ìˆ˜ì¤€ìœ¼ë¡œ ë‚œì²­ ì¦ìƒì´ ì‹œì‘ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤. "
         "ë°©ìŒ í—¤ë“œí° ì°©ìš© ë˜ëŠ” ë…¸ì¶œ ì‹œê°„ì„ ìµœì†Œí™”í•˜ì„¸ìš”."),
    (0, "ğŸ”´ ê·¹ì‹¬í•œ ì†ŒìŒ",
         "ì°©ì•”ê¸°Â·ê²½ì  ìˆ˜ì¤€ì˜ ì†ŒìŒì…ë‹ˆë‹¤. ê·€ë§ˆê°œ ì°©ìš©ì´ í•„ìš”í•˜ë©°, "
         "ì¥ì‹œê°„ ë…¸ì¶œì€ ì²­ë ¥ ì†ìƒì„ ì¼ìœ¼í‚¬ ìˆ˜ ìˆìœ¼ë‹ˆ ì¦‰ì‹œ ì¥ì†Œë¥¼ ì´ë™í•˜ì„¸ìš”."),
]

PATTERN_TEXT: dict[str, dict[str, str]] = {
    # ğŸŒ¡ï¸ ì˜¨ë„ -----------------------------------------------------------------
    "temperature": {
        "EXTREME":     "ì˜¨ë„ê°€ í•˜ë£¨ì— **8 Â°C ì´ìƒ** ê¸‰ë³€í–ˆìŠµë‹ˆë‹¤. ëƒ‰Â·ë‚œë°© ì„¤ë¹„ë¥¼ ì¦‰ì‹œ ì ê²€í•˜ì„¸ìš”.",
        "VERY_HIGH":   "ì˜¨ë„ ë³€ë™ì´ **5â€“8 Â°C** êµ¬ê°„ìœ¼ë¡œ ë§¤ìš° í½ë‹ˆë‹¤. ì œì–´ ë¡œì§ì„ í™•ì¸í•˜ì„¸ìš”.",
        "HIGH":        "ì˜¨ë„ ë³€ë™ì´ **3â€“5 Â°C**ë¡œ ë‹¤ì†Œ í½ë‹ˆë‹¤. íˆìŠ¤í…Œë¦¬ì‹œìŠ¤ë¥¼ ì¢í˜€ ë³´ì„¸ìš”.",
        "MODERATE":    "ì˜¨ë„ ë³€ë™ì´ **2â€“3 Â°C** ì •ë„ë¡œ ì ë‹¹í•©ë‹ˆë‹¤.",
        "STABLE":      "ì˜¨ë„ê°€ ëŒ€ì²´ë¡œ **ì•ˆì •ì (1â€“2 Â°C)** ì…ë‹ˆë‹¤.",
        "VERY_STABLE": "ì˜¨ë„ê°€ **ë§¤ìš° ì•ˆì •ì (â‰¤1 Â°C)** ì…ë‹ˆë‹¤."
    },

    # ğŸ”Š ì†ŒìŒ ------------------------------------------------------------------
    "noise": {
        "EXTREME":     "ì†ŒìŒì´ **10 dB ì´ìƒ** ê¸‰ë“±ë½í–ˆìŠµë‹ˆë‹¤. ì†ŒìŒì›ì„ ì¦‰ì‹œ ì ê²€í•˜ì„¸ìš”.",
        "VERY_HIGH":   "ì†ŒìŒ ë³€ë™ì´ **7â€“10 dB**ë¡œ ë§¤ìš° í½ë‹ˆë‹¤. ë°©ìŒ ì¡°ì¹˜ê°€ í•„ìš”í•©ë‹ˆë‹¤.",
        "HIGH":        "ì†ŒìŒ ë³€ë™ì´ **5â€“7 dB**ë¡œ í° í¸ì…ë‹ˆë‹¤. íŒ¬ ì†ë„Â·ìš´ì˜ ì‹œê°„ì„ ì¡°ì •í•˜ì„¸ìš”.",
        "MODERATE":    "ì†ŒìŒ ë³€ë™ì´ **3â€“5 dB** ì •ë„ë¡œ ì ë‹¹í•©ë‹ˆë‹¤.",
        "STABLE":      "ì†ŒìŒ ë³€ë™ì´ **1â€“3 dB** ì´ë‚´ë¡œ ì•ˆì •ì ì…ë‹ˆë‹¤.",
        "VERY_STABLE": "ì†ŒìŒ ë³€ë™ì´ **ë§¤ìš° ì‘ìŠµë‹ˆë‹¤(â‰¤1 dB)**."
    },

    # ğŸ’§ ìŠµë„ ------------------------------------------------------------------
    "humidity": {
        "EXTREME":     "ìŠµë„ê°€ **30 %RH ì´ìƒ** ê¸‰ë³€í–ˆìŠµë‹ˆë‹¤. ëˆ„ìˆ˜Â·ê³µì¡° ì‹œìŠ¤í…œì„ ì ê²€í•˜ì„¸ìš”.",
        "VERY_HIGH":   "ìŠµë„ ë³€ë™ì´ **20â€“30 %RH**ë¡œ ë§¤ìš° í½ë‹ˆë‹¤. ê°€ìŠµÂ·ì œìŠµ ì¥ì¹˜ë¥¼ ì¡°ì •í•˜ì„¸ìš”.",
        "HIGH":        "ìŠµë„ ë³€ë™ì´ **15â€“20 %RH**ë¡œ í° í¸ì…ë‹ˆë‹¤. ì„¤ë¹„ ìš´ì „ì„ ìµœì í™”í•˜ì„¸ìš”.",
        "MODERATE":    "ìŠµë„ ë³€ë™ì´ **10â€“15 %RH** ì •ë„ë¡œ ì ë‹¹í•©ë‹ˆë‹¤.",
        "STABLE":      "ìŠµë„ ë³€ë™ì´ **5â€“10 %RH**ë¡œ ì•ˆì •ì ì…ë‹ˆë‹¤.",
        "VERY_STABLE": "ìŠµë„ ë³€ë™ì´ **ë§¤ìš° ì‘ìŠµë‹ˆë‹¤(â‰¤5 %RH)**."
    },

    # ğŸ§ª TVOC ------------------------------------------------------------------
    "tvoc": {
        "EXTREME":     "TVOCê°€ **1000 ppb ì´ìƒ** í¬ê²Œ ì¶œë ì…ë‹ˆë‹¤. ì¦‰ì‹œ í™˜ê¸°Â·í•„í„° ì ê²€ í•„ìš”!",
        "VERY_HIGH":   "TVOC ë³€ë™ì´ **700â€“1000 ppb**ë¡œ ë§¤ìš° í½ë‹ˆë‹¤. í™˜ê¸° ì£¼ê¸°ë¥¼ ëŠ˜ë ¤ì£¼ì„¸ìš”.",
        "HIGH":        "TVOC ë³€ë™ì´ **500â€“700 ppb**ë¡œ í° í¸ì…ë‹ˆë‹¤. ê³µê¸°ì •í™”ë¥¼ ê²€í† í•˜ì„¸ìš”.",
        "MODERATE":    "TVOC ë³€ë™ì´ **300â€“500 ppb** ìˆ˜ì¤€ì…ë‹ˆë‹¤.",
        "STABLE":      "TVOC ë³€ë™ì´ **100â€“300 ppb**ë¡œ ì•ˆì •ì ì…ë‹ˆë‹¤.",
        "VERY_STABLE": "TVOC ë³€ë™ì´ **ë§¤ìš° ì‘ìŠµë‹ˆë‹¤(â‰¤100 ppb)**."
    },

    # ğŸŒ«ï¸ PM10 -----------------------------------------------------------------
    "pm10": {
        "EXTREME":     "PM10 ë†ë„ ë³€ë™ì´ **100 Âµg/mÂ³ ì´ìƒ**ì…ë‹ˆë‹¤. ì¦‰ì‹œ ëŒ€ì‘í•˜ì„¸ìš”.",
        "VERY_HIGH":   "PM10 ë³€ë™ì´ **70â€“100 Âµg/mÂ³**ë¡œ ë§¤ìš° í½ë‹ˆë‹¤.",
        "HIGH":        "PM10 ë³€ë™ì´ **50â€“70 Âµg/mÂ³**ë¡œ í° í¸ì…ë‹ˆë‹¤.",
        "MODERATE":    "PM10 ë³€ë™ì´ **30â€“50 Âµg/mÂ³**ì…ë‹ˆë‹¤.",
        "STABLE":      "PM10 ë³€ë™ì´ **10â€“30 Âµg/mÂ³**ë¡œ ì•ˆì •ì ì…ë‹ˆë‹¤.",
        "VERY_STABLE": "PM10 ë³€ë™ì´ **ë§¤ìš° ì‘ìŠµë‹ˆë‹¤(â‰¤10 Âµg/mÂ³)**."
    },

    # ğŸŒ PM2.5 -----------------------------------------------------------------
    "pm2_5": {
        "EXTREME":     "PM2.5 ë†ë„ ë³€ë™ì´ **50 Âµg/mÂ³ ì´ìƒ**ì…ë‹ˆë‹¤.",
        "VERY_HIGH":   "PM2.5 ë³€ë™ì´ **30â€“50 Âµg/mÂ³**ë¡œ ë§¤ìš° í½ë‹ˆë‹¤.",
        "HIGH":        "PM2.5 ë³€ë™ì´ **20â€“30 Âµg/mÂ³**ë¡œ í° í¸ì…ë‹ˆë‹¤.",
        "MODERATE":    "PM2.5 ë³€ë™ì´ **10â€“20 Âµg/mÂ³**ì…ë‹ˆë‹¤.",
        "STABLE":      "PM2.5 ë³€ë™ì´ **5â€“10 Âµg/mÂ³**ë¡œ ì•ˆì •ì ì…ë‹ˆë‹¤.",
        "VERY_STABLE": "PM2.5 ë³€ë™ì´ **ë§¤ìš° ì‘ìŠµë‹ˆë‹¤(â‰¤5 Âµg/mÂ³)**."
    },
}

def describe_pattern(metric: str, label: str) -> str:
    """íŒ¨í„´ ë¼ë²¨ì„ ì‚¬ìš©ì ë¬¸ì¥ìœ¼ë¡œ ë³€í™˜ (ë¯¸ì •ì˜ ì‹œ ê¸°ë³¸ ë¬¸êµ¬)"""
    return PATTERN_TEXT.get(metric, {}).get(
        label,
        f"{metric} ë³€ë™ íŒ¨í„´: {label}"
    )

def crowd_time_message(tvoc_resp) -> str:
    """
    ClusterResponse(tvoc) âœ ê°€ì¥ ë†’ì€ ì¤‘ì‹¬ê°’ í´ëŸ¬ìŠ¤í„°ì˜ time_range ë°˜í™˜
    """
    # â‘  TVOC ì¤‘ì‹¬ê°’ì´ ê°€ì¥ ë†’ì€ í´ëŸ¬ìŠ¤í„° ID
    peak_cluster = max(tvoc_resp.cluster_centers,
                       key=lambda cid: tvoc_resp.cluster_centers[cid])
    # â‘¡ í•´ë‹¹ IDì— ëŒ€ì‘í•˜ëŠ” time_range ì°¾ê¸°
    tr = next(p.time_range for p in tvoc_resp.peak_time
              if p.cluster_id == peak_cluster)
    return f"ê°€ì¥ ë¶ë¹ˆ ì‹œê°„ëŒ€ëŠ” **{tr.start}â€“{tr.end}** ì…ë‹ˆë‹¤."